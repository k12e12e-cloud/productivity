# 지식베이스 (Knowledge Base) 테스트 시나리오

## 1. API 기본 동작

### 1.1 지식 노트 CRUD
```bash
# CREATE — 새 노트 생성
curl -s -X POST http://localhost:3000/api/knowledge \
  -H "Content-Type: application/json" \
  -d '{"title":"React Server Components 핵심","content":"RSC는 서버에서만 실행되는 컴포넌트. 번들 크기 감소, 직접 DB 접근 가능.","tags":["react","서버컴포넌트","프론트엔드"]}' | jq .

# READ ALL — 전체 목록 조회
curl -s http://localhost:3000/api/knowledge | jq .

# READ ONE — 단건 조회 (위에서 받은 id 사용)
curl -s http://localhost:3000/api/knowledge/{id} | jq .

# UPDATE — 노트 수정
curl -s -X PATCH http://localhost:3000/api/knowledge/{id} \
  -H "Content-Type: application/json" \
  -d '{"title":"React Server Components 핵심 정리","tags":["react","RSC","프론트엔드"]}' | jq .

# DELETE — 노트 삭제
curl -s -X DELETE http://localhost:3000/api/knowledge/{id} | jq .
```

### 1.2 검색 + 태그 필터
```bash
# 텍스트 검색
curl -s "http://localhost:3000/api/knowledge?q=React" | jq .

# 태그 필터
curl -s "http://localhost:3000/api/knowledge?tags=react,프론트엔드" | jq .

# 텍스트 + 태그 동시
curl -s "http://localhost:3000/api/knowledge?q=서버&tags=react" | jq .

# 유니크 태그 목록
curl -s http://localhost:3000/api/knowledge/tags | jq .
```

### 1.3 입력 검증
```bash
# 제목 없이 생성 → 400
curl -s -X POST http://localhost:3000/api/knowledge \
  -H "Content-Type: application/json" \
  -d '{"content":"내용만"}' | jq .

# 내용 없이 생성 → 400
curl -s -X POST http://localhost:3000/api/knowledge \
  -H "Content-Type: application/json" \
  -d '{"title":"제목만"}' | jq .

# 잘못된 source → 400
curl -s -X POST http://localhost:3000/api/knowledge \
  -H "Content-Type: application/json" \
  -d '{"title":"테스트","content":"내용","source":"invalid"}' | jq .

# 존재하지 않는 ID 조회 → 404
curl -s http://localhost:3000/api/knowledge/nonexistent-id | jq .

# 존재하지 않는 ID 삭제 → 404
curl -s -X DELETE http://localhost:3000/api/knowledge/nonexistent-id | jq .
```

---

## 2. UI 테스트 (수동)

### 2.1 사이드바 네비게이션
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 사이드바에서 "지식베이스" 클릭 | `/knowledge` 이동, BookOpen 아이콘 + 활성 상태 |
| 2 | `/knowledge` 페이지에서 다른 메뉴 클릭 후 돌아오기 | 상태 유지 확인 |

### 2.2 3컬럼 레이아웃
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | `/knowledge` 접속 (노트 없음) | 왼쪽: "태그 없음", 중앙: "지식 노트가 없습니다", 오른쪽: "노트를 선택하세요" |
| 2 | 노트 여러 개 생성 후 접속 | 왼쪽: 태그 목록, 중앙: 노트 카드 리스트, 오른쪽: 선택 대기 |

### 2.3 노트 생성
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | "새 노트" 버튼 클릭 | 생성 다이얼로그 열림 |
| 2 | 제목+내용+태그 입력 후 "생성" | 다이얼로그 닫힘, 리스트에 새 노트 즉시 표시 |
| 3 | 제목 비우고 "생성" | "제목을 입력하세요" 에러 표시 |
| 4 | 내용 비우고 "생성" | "내용을 입력하세요" 에러 표시 |
| 5 | "취소" 클릭 | 다이얼로그 닫힘, 변경 없음 |

### 2.4 노트 조회 + 상세
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 리스트에서 노트 카드 클릭 | 오른쪽 패널에 제목, 내용, 태그, 출처, 생성/수정일 표시 |
| 2 | 다른 노트 클릭 | 상세 패널이 해당 노트로 변경 |
| 3 | 같은 태그를 가진 노트가 있을 때 | "관련 노트" 섹션에 목록 표시 |
| 4 | 관련 노트 클릭 | 해당 노트로 상세 전환 |

### 2.5 노트 편집
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 상세에서 연필(편집) 아이콘 클릭 | 제목→Input, 내용→Textarea, 태그→Input으로 전환 |
| 2 | 내용 수정 후 저장(Save) 아이콘 클릭 | 수정사항 반영, 보기 모드로 복귀 |
| 3 | 내용 수정 후 취소(X) 아이콘 클릭 | 원래 내용으로 복원, 보기 모드로 복귀 |

### 2.6 노트 삭제
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 상세에서 휴지통 아이콘 클릭 | confirm 다이얼로그 표시 |
| 2 | confirm에서 "확인" | 노트 삭제, 리스트에서 제거, 상세 패널 초기화 |
| 3 | confirm에서 "취소" | 변경 없음 |

### 2.7 검색
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 검색바에 키워드 입력 | 제목/내용에 키워드 포함된 노트만 필터링 |
| 2 | 검색 결과 없을 때 | "검색 결과 없음" 표시 |
| 3 | 검색어 삭제 | 전체 노트 복원 |

### 2.8 태그 필터
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 왼쪽 사이드바에서 태그 클릭 | 해당 태그를 가진 노트만 중앙 리스트에 표시, 태그 활성 스타일 |
| 2 | 여러 태그 선택 | OR 조건으로 합집합 노트 표시 |
| 3 | "필터 초기화" 클릭 | 모든 태그 선택 해제, 전체 노트 복원 |
| 4 | 검색 + 태그 필터 동시 | 두 조건 모두 만족하는 노트만 표시 |

---

## 3. AI 연동 테스트 (인박스 채팅)

### 3.1 명시적 지식 저장 요청
| # | 사용자 입력 | 기대 결과 |
|---|-----------|----------|
| 1 | "React에서 useEffect 클린업 함수는 언마운트 시 실행돼. 이거 기억해줘" | `knowledgeActions` create 포함, 지식 노트 자동 생성, SSE `knowledge_created` 이벤트 |
| 2 | "SQLite WAL 모드는 동시 읽기/쓰기 가능. 메모해" | 지식 노트 생성 + 적절한 태그 자동 부여 |
| 3 | "이전에 저장한 React useEffect 노트에 의존성 배열 내용도 추가해줘" | `knowledgeActions` update 포함, 기존 노트 수정 |

### 3.2 AI 자발적 지식 저장
| # | 사용자 입력 | 기대 결과 |
|---|-----------|----------|
| 1 | "Next.js App Router에서 layout.tsx는 공유 레이아웃이고 page.tsx가 실제 페이지야. 이 구조로 프로젝트 리팩토링 태스크 만들어줘" | 태스크 생성 + **추가로** Next.js 구조에 대한 지식 노트도 자발적으로 생성 |
| 2 | "Drizzle ORM에서 .get()은 단건, .all()은 다건 조회야" | 기술 인사이트로 판단하여 자발적 지식 노트 생성 |

### 3.3 지식 컨텍스트 활용
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 이전에 저장한 지식과 관련된 질문 | AI가 기존 지식 노트를 참조하여 응답 (시스템 프롬프트에 최근 20개 노트 주입됨) |
| 2 | 기존 지식과 충돌하는 새 정보 | update 액션으로 기존 노트 수정 |

### 3.4 원자성 규칙
| # | 사용자 입력 | 기대 결과 |
|---|-----------|----------|
| 1 | "Git rebase는 커밋을 재배치하고, cherry-pick은 특정 커밋만 가져오는 거야. 둘 다 기억해" | 2개의 개별 지식 노트로 분리 생성 (rebase 1개 + cherry-pick 1개) |

---

## 4. 대시보드 위젯

| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 대시보드 접속 (노트 없음) | "지식베이스" 카드에 "0 노트" 표시 |
| 2 | 노트 3개 존재 | "3 노트" + 최근 노트 제목 최대 5개 표시 |
| 3 | 위젯 클릭 | `/knowledge` 페이지로 이동 |

---

## 5. 통합 시나리오

### 5.1 전체 플로우
1. `/knowledge` 접속 → 빈 상태 확인
2. "새 노트" → 제목: "TypeScript 제네릭 기본", 내용: "함수에 타입 파라미터를 전달하여 재사용성 확보", 태그: "typescript, 제네릭" → 생성
3. "새 노트" → 제목: "TypeScript 유틸리티 타입", 내용: "Partial, Pick, Omit 등 내장 타입", 태그: "typescript, 타입" → 생성
4. 왼쪽 태그 사이드바에 "typescript", "제네릭", "타입" 표시 확인
5. "typescript" 태그 클릭 → 두 노트 모두 표시
6. "제네릭" 태그 클릭 → 제네릭 노트만 표시
7. 필터 초기화 → 전체 복원
8. 검색바에 "Partial" 입력 → 유틸리티 타입 노트만 표시
9. 유틸리티 타입 노트 클릭 → 상세 표시 + "관련 노트"에 제네릭 노트 표시 (같은 "typescript" 태그)
10. 관련 노트 "TypeScript 제네릭 기본" 클릭 → 상세 전환
11. 편집 → 내용 수정 → 저장 확인
12. 삭제 → 리스트에서 제거 확인
13. 인박스에서 "TypeScript는 구조적 타이핑을 사용해. 기억해줘" 입력 → AI가 지식 노트 자동 생성
14. `/knowledge`에서 새 노트 확인
15. 대시보드에서 위젯 노트 수 확인

### 5.2 에지 케이스
| # | 시나리오 | 기대 결과 |
|---|---------|----------|
| 1 | 태그 없는 노트 생성 | 정상 생성, 태그 사이드바에 영향 없음 |
| 2 | 매우 긴 내용 (5000자+) | 정상 저장, 카드에서는 100자 프리뷰 |
| 3 | 특수문자 포함 제목/내용 | 정상 저장 및 표시 |
| 4 | 동일 태그 중복 입력 "react, react" | 중복 허용 (UI 레벨), 태그 목록은 유니크 |
| 5 | 빈 검색어 | 전체 노트 표시 (필터 없음) |
| 6 | 노트 0개 상태에서 태그 API | 빈 배열 `[]` 반환 |
